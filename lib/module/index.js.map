{"version":3,"sources":["index.js"],"names":["PFX_FOR_EACH","PFX_WITH_ANY","MSG","config","messages","OP_EQUAL","OP_NOT_EQUAL","OP_NOT","OP_GREATER_THAN","OP_GREATER_THAN_OR_EQUAL","OP_LESS_THAN","OP_LESS_THAN_OR_EQUAL","OP_IN","OP_NOT_IN","OP_EXISTS","OP_MATCH","OP_MATCH_ANY","OP_TYPE","OP_HAS_KEYS","OP_START_WITH","OP_END_WITH","OP_SIZE","OP_SUM","OP_KEYS","OP_VALUES","OP_ENTRIES","OP_GET_TYPE","OP_ADD","OP_SUB","OP_MUL","OP_DIV","OP_SET","OP_ADD_ITEM","OP_ASSIGN","OP_PICK","OP_GET_BY_INDEX","OP_GET_BY_KEY","OP_OMIT","OP_GROUP","OP_SORT","OP_REVERSE","OP_EVAL","OP_MERGE","OP_FILTER","OP_REMAP","OP_TO_JSON","OP_TO_OBJ","OP_IF","addValidatorToMap","left","right","args","test","Array","isArray","InvalidArgument","OPERAND_NOT_ARRAY","equal","getValidator","find","element","notEqual","every","OPERAND_NOT_BOOL","prefix","context","rule","r","match","matched","$$ERROR","found","OPERAND_NOT_STRING","toLowerCase","key","startsWith","endsWith","length","OPERAND_NOT_TUPLE","evaluated","evaluateExpr","addProcessorToMap","sum","item","value","undefined","VALUE_NOT_COLLECTION","concat","$$PARENT","$$CURRENT","VALUE_NOT_OBJECT","OPERAND_NOT_OBJECT","rightValue","expr","formatPrefix","x","reduce","result","Object","assign","OPERAND_NOT_TUPLE_2_OR_3","condition","ret","JSON","stringify","parse","getUnmatchedExplanation","op","name","leftValue","getter","validationErrors","tag","opValue","handler","INVALID_VALIDATOR_HANDLER","evaluate","getProcessor","INVALID_PROCESSOR_HANDLER","evaluateUnary","evaluateByOpMeta","currentValue","opMeta","validateCollection","actual","collectionOp","expectedFieldValue","unmatchedKey","INVALID_COLLECTION_OP","evaluateCollection","_map","_mapValues","i","expected","passObjectCheck","fieldName","l","substr","getValidatorTag","INVALID_VALIDATION_OP","matchResult","actualType","actualFieldValue","ok","reason","setOp","map","exprItem","typeExpr","SYNTAX_NUMBER_AS_EXPR","pos","indexOf","getProcessorTagAndType","INVALID_PROCESSING_OP","REQUIRE_RIGHT_OPERAND","SYNTAX_INVALID_EXPR","$$ROOT","hasOperator","SYNTAX_OP_NOT_ALONE","compleyKey","childFieldValue","JES","constructor","ValidationError","update"],"mappings":"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","sourcesContent":["// JSON Expression Syntax (JES)\nimport _isEqual from'lodash/isEqual';\nimport _isInteger from'lodash/isInteger';\nimport _has from'lodash/has';\nimport _size from'lodash/size';\nimport _reduce from'lodash/reduce';\nimport _reverse from'lodash/reverse';\nimport _keys from'lodash/keys';\nimport _values from'lodash/values';\nimport _castArray from'lodash/castArray';\nimport _pick from'lodash/pick';\nimport _pickBy from'lodash/pickBy';\nimport _get from'lodash/get';\nimport _set from'lodash/set';\nimport _nth from'lodash/nth';\nimport _omit from'lodash/omit';\nimport _omitBy from'lodash/omitBy';\nimport _groupBy from'lodash/groupBy';\nimport _sortBy from'lodash/sortBy';\nimport _filter from'lodash/filter';\nimport _map from'lodash/map';\nimport _mapValues from'lodash/mapValues';\nimport _find from'lodash/find';\nimport _findIndex from'lodash/findIndex';\n\nimport { ValidationError, InvalidArgument } from'@genx/error';\nimport { remap, isPlainObject } from'@genx/july';\n\nimport config from './config';\nimport './locale/msg.en-US';\n\nconst PFX_FOR_EACH = '|>'; // map each\nconst PFX_WITH_ANY = '|*'; // with any\n\nconst MSG = config.messages;\n\n//Validators\nconst OP_EQUAL = ['$eq', '$eql', '$equal'];\nconst OP_NOT_EQUAL = ['$ne', '$neq', '$notEqual'];\nconst OP_NOT = ['$not'];\nconst OP_GREATER_THAN = ['$gt', '$>', '$greaterThan'];\nconst OP_GREATER_THAN_OR_EQUAL = ['$gte', '$>=', '$greaterThanOrEqual'];\nconst OP_LESS_THAN = ['$lt', '$<', '$lessThan'];\nconst OP_LESS_THAN_OR_EQUAL = ['$lte', '$<=', '$lessThanOrEqual'];\n\nconst OP_IN = ['$in'];\nconst OP_NOT_IN = ['$nin', '$notIn'];\nconst OP_EXISTS = ['$exist', '$exists', '$notNull'];\nconst OP_MATCH = ['$has', '$match', '$all'];\nconst OP_MATCH_ANY = ['$any', '$or', '$either'];\nconst OP_TYPE = ['$is', '$typeOf'];\nconst OP_HAS_KEYS = ['$hasKey', '$hasKeys', '$withKey', '$withKeys'];\nconst OP_START_WITH = ['$startWith', '$startsWith'];\nconst OP_END_WITH = ['$endWith', '$endsWith'];\n\n//OP_EVAL\n\n//Query & aggregate processors\nconst OP_SIZE = ['$size', '$length', '$count'];\nconst OP_SUM = ['$sum', '$total'];\nconst OP_KEYS = ['$keys'];\nconst OP_VALUES = ['$values'];\nconst OP_ENTRIES = ['$entries', '$toArray'];\nconst OP_GET_TYPE = ['$type'];\n\n//Manipulate processors\nconst OP_ADD = ['$add', '$plus', '$inc'];\nconst OP_SUB = ['$sub', '$subtract', '$minus', '$dec'];\nconst OP_MUL = ['$mul', '$multiply', '$times'];\nconst OP_DIV = ['$div', '$divide'];\nconst OP_SET = ['$set', '$=', '$value'];\nconst OP_ADD_ITEM = ['$addItem', '$override'];\nconst OP_ASSIGN = ['$assign', '$addFields'];\n\nconst OP_PICK = ['$pick'];\nconst OP_GET_BY_INDEX = ['$at', '$getByIndex', '$nth'];\nconst OP_GET_BY_KEY = ['$of', '$getByKey'];\nconst OP_OMIT = ['$omit']; // filter by key\nconst OP_GROUP = ['$group', '$groupBy'];\nconst OP_SORT = ['$sort', '$orderBy', '$sortBy'];\nconst OP_REVERSE = ['$reverse'];\nconst OP_EVAL = ['$eval', '$apply'];\nconst OP_MERGE = ['$merge'];\nconst OP_FILTER = ['$filter', '$select']; // filter by value\nconst OP_REMAP = ['$remap', '$mapKeys'];\nconst OP_TO_JSON = ['$json', '$toJSON', '$stringify'];\nconst OP_TO_OBJ = ['$object', '$parseJSON'];\n\n//Condition processors\nconst OP_IF = ['$if'];\n\nconfig.addValidatorToMap(OP_EQUAL, 'OP_EQUAL', (left, right) =>\n    _isEqual(left, right)\n);\nconfig.addValidatorToMap(\n    OP_NOT_EQUAL,\n    'OP_NOT_EQUAL',\n    (left, right) => !_isEqual(left, right)\n);\nconfig.addValidatorToMap(\n    OP_NOT,\n    'OP_NOT',\n    (left, ...args) => !test(left, 'OP_MATCH', ...args)\n);\nconfig.addValidatorToMap(\n    OP_GREATER_THAN,\n    'OP_GREATER_THAN',\n    (left, right) => left > right\n);\nconfig.addValidatorToMap(\n    OP_GREATER_THAN_OR_EQUAL,\n    'OP_GREATER_THAN_OR_EQUAL',\n    (left, right) => left >= right\n);\nconfig.addValidatorToMap(\n    OP_LESS_THAN,\n    'OP_LESS_THAN',\n    (left, right) => left < right\n);\nconfig.addValidatorToMap(\n    OP_LESS_THAN_OR_EQUAL,\n    'OP_LESS_THAN_OR_EQUAL',\n    (left, right) => left <= right\n);\nconfig.addValidatorToMap(OP_IN, 'OP_IN', (left, right) => {\n    if (right == null) return false;\n    if (!Array.isArray(right)) {\n        throw new InvalidArgument(MSG.OPERAND_NOT_ARRAY('OP_IN'));\n    }\n\n    const equal = config.getValidator('OP_EQUAL');\n    return right.find((element) => equal(left, element));\n});\nconfig.addValidatorToMap(OP_NOT_IN, 'OP_NOT_IN', (left, right) => {\n    if (right == null) return true;\n    if (!Array.isArray(right)) {\n        throw new InvalidArgument(MSG.OPERAND_NOT_ARRAY('OP_NOT_IN'));\n    }\n\n    const notEqual = config.getValidator('OP_NOT_EQUAL');\n\n    return right.every((element) => notEqual(left, element));\n});\nconfig.addValidatorToMap(OP_EXISTS, 'OP_EXISTS', (left, right) => {\n    if (typeof right !== 'boolean') {\n        throw new InvalidArgument(MSG.OPERAND_NOT_BOOL('OP_EXISTS'));\n    }\n\n    return right ? left != null : left == null;\n});\nconfig.addValidatorToMap(\n    OP_MATCH,\n    'OP_MATCH',\n    (left, right, prefix, context) => {\n        if (Array.isArray(right)) {\n            return right.every((rule) => {\n                const r = match(left, rule, prefix);\n                return r[0];\n            });\n        }\n\n        const r = match(left, right, prefix);\n        const matched = r[0];\n\n        if (!matched && context) {\n            context.$$ERROR = r[1];\n        }\n\n        return matched;\n    }\n);\nconfig.addValidatorToMap(\n    OP_MATCH_ANY,\n    'OP_MATCH_ANY',\n    (left, right, prefix, context) => {\n        if (!Array.isArray(right)) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_ARRAY('OP_MATCH_ANY'));\n        }\n\n        let found = right.find((rule) => {\n            const r = match(left, rule, prefix);\n            const matched = r[0];\n\n            if (!matched && context) {\n                context.$$ERROR = r[1];\n            }\n\n            return matched;\n        });\n\n        return found ? true : false;\n    }\n);\nconfig.addValidatorToMap(OP_TYPE, 'OP_TYPE', (left, right) => {\n    if (typeof right !== 'string') {\n        throw new InvalidArgument(MSG.OPERAND_NOT_STRING('OP_TYPE'));\n    }\n\n    right = right.toLowerCase();\n\n    if (right === 'array') {\n        return Array.isArray(left);\n    }\n\n    if (right === 'integer') {\n        return _isInteger(left);\n    }\n\n    if (right === 'text') {\n        return typeof left === 'string';\n    }\n\n    return typeof left === right;\n});\nconfig.addValidatorToMap(OP_HAS_KEYS, 'OP_HAS_KEYS', (left, right) => {\n    if (typeof left !== 'object') return false;\n\n    return Array.isArray(right)\n        ? right.every((key) => _has(left, key))\n        : _has(left, right);\n});\nconfig.addValidatorToMap(OP_START_WITH, 'OP_START_WITH', (left, right) => {\n    if (typeof left !== 'string') return false;\n    if (typeof right !== 'string') {\n        throw new InvalidArgument(MSG.OPERAND_NOT_STRING('OP_START_WITH'));\n    }\n\n    return left.startsWith(right);\n});\nconfig.addValidatorToMap(OP_END_WITH, 'OP_END_WITH', (left, right) => {\n    if (typeof left !== 'string') return false;\n    if (typeof right !== 'string') {\n        throw new InvalidArgument(MSG.OPERAND_NOT_STRING('OP_END_WITH'));\n    }\n\n    return left.endsWith(right);\n});\n//embedded processors in validation pipeline\nconfig.addValidatorToMap(OP_EVAL, 'OP_EVAL', (left, right, prefix, context) => {\n    if (!Array.isArray(right) || right.length !== 2) {\n        throw new InvalidArgument(MSG.OPERAND_NOT_TUPLE('OP_EVAL'));\n    }\n\n    const evaluated = evaluateExpr(left, right[0], prefix);\n\n    const r = match(evaluated, right[1], prefix);\n    const matched = r[0];\n\n    if (!matched && context) {\n        context.$$ERROR = r[1];\n    }\n\n    return matched;\n});\n\n// [ <op name>, <unary> ]\nconfig.addProcessorToMap(OP_SIZE, 'OP_SIZE', true, (left) => _size(left));\nconfig.addProcessorToMap(OP_SUM, 'OP_SUM', true, (left) =>\n    _reduce(\n        left,\n        (sum, item) => {\n            sum += item;\n            return sum;\n        },\n        0\n    )\n);\nconfig.addProcessorToMap(OP_KEYS, 'OP_KEYS', true, (left) => _keys(left));\nconfig.addProcessorToMap(OP_VALUES, 'OP_VALUES', true, (left) => _values(left));\nconfig.addProcessorToMap(OP_ENTRIES, 'OP_ENTRIES', true, (left) => _map(left, (value,key) => ({ key, value })));\nconfig.addProcessorToMap(OP_GET_TYPE, 'OP_GET_TYPE', true, (left) =>\n    Array.isArray(left) ? 'array' : _isInteger(left) ? 'integer' : typeof left\n);\nconfig.addProcessorToMap(OP_REVERSE, 'OP_REVERSE', true, (left) =>\n    _reverse(left)\n);\n\nconfig.addProcessorToMap(\n    OP_ADD,\n    'OP_ADD',\n    false,\n    (left, right) => left + right\n);\nconfig.addProcessorToMap(\n    OP_SUB,\n    'OP_SUB',\n    false,\n    (left, right) => left - right\n);\nconfig.addProcessorToMap(\n    OP_MUL,\n    'OP_MUL',\n    false,\n    (left, right) => left * right\n);\nconfig.addProcessorToMap(\n    OP_DIV,\n    'OP_DIV',\n    false,\n    (left, right) => left / right\n);\nconfig.addProcessorToMap(\n    OP_SET,\n    'OP_SET',\n    false,\n    (left, right, prefix, context) =>\n        evaluateExpr(undefined, right, prefix, context, true)\n);\nconfig.addProcessorToMap(\n    OP_ADD_ITEM,\n    'OP_ADD_ITEM',\n    false,\n    (left, right, prefix, context) => {\n        if (typeof left !== 'object') {\n            throw new InvalidArgument(MSG.VALUE_NOT_COLLECTION('OP_ADD_ITEM'));\n        }\n\n        if (Array.isArray(left)) {\n            return left.concat(right);\n        }\n\n        if (!Array.isArray(right) || right.length !== 2) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_TUPLE('OP_ADD_ITEM'));\n        }\n\n        return {\n            ...left,\n            [right[0]]: evaluateExpr(left, right[1], prefix, {\n                ...context,\n                $$PARENT: context.$$CURRENT,\n                $$CURRENT: left,\n            }),\n        };\n    }\n);\nconfig.addProcessorToMap(\n    OP_ASSIGN,\n    'OP_ASSIGN',\n    false,\n    (left, right, prefix, context) => {\n        if (!isPlainObject(left)) {\n            if (left == null) {\n                left = {};\n            } else {\n                throw new InvalidArgument(MSG.VALUE_NOT_OBJECT('OP_ASSIGN'));\n            }\n        }\n\n        if (!isPlainObject(right)) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_OBJECT('OP_ASSIGN'));\n        }\n\n        const rightValue = _mapValues(right, (expr, key) =>\n            evaluateExpr(left[key], expr, MSG.formatPrefix(key, prefix), {\n                ...context,\n                $$PARENT: left,\n                $$CURRENT: left[key],\n            })\n        );\n\n        return { ...left, ...rightValue };\n    }\n);\nconfig.addProcessorToMap(OP_PICK, 'OP_PICK', false, (left, right, prefix) => {\n    if (left == null) return null;\n\n    if (typeof right !== 'object') {\n        right = _castArray(right);\n    }\n\n    if (Array.isArray(right)) {\n        return _pick(left, right);\n    }\n\n    return _pickBy(\n        left,\n        (x, key) => match(key, right, MSG.formatPrefix(key, prefix))[0]\n    );\n});\nconfig.addProcessorToMap(\n    OP_GET_BY_INDEX,\n    'OP_GET_BY_INDEX',\n    false,\n    (left, right) => _nth(left, right)\n);\nconfig.addProcessorToMap(OP_GET_BY_KEY, 'OP_GET_BY_KEY', false, (left, right) =>\n    _get(left, right)\n);\nconfig.addProcessorToMap(OP_OMIT, 'OP_OMIT', false, (left, right, prefix) => {\n    if (left == null) return null;\n\n    if (typeof right !== 'object') {\n        right = _castArray(right);\n    }\n\n    if (Array.isArray(right)) {\n        return _omit(left, right);\n    }\n\n    return _omitBy(\n        left,\n        (x, key) => match(key, right, MSG.formatPrefix(key, prefix))[0]\n    );\n});\nconfig.addProcessorToMap(OP_GROUP, 'OP_GROUP', false, (left, right) =>\n    _groupBy(left, right)\n);\nconfig.addProcessorToMap(OP_SORT, 'OP_SORT', false, (left, right) =>\n    _sortBy(left, right)\n);\nconfig.addProcessorToMap(OP_EVAL, 'OP_EVAL', false, evaluateExpr);\nconfig.addProcessorToMap(\n    OP_MERGE,\n    'OP_MERGE',\n    false,\n    (left, right, prefix, context) => {\n        if (!Array.isArray(right)) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_ARRAY('OP_MERGE'));\n        }\n\n        return right.reduce(\n            (result, expr, key) =>\n                Object.assign(\n                    result,\n                    evaluateExpr(left, expr, MSG.formatPrefix(key, prefix), {\n                        ...context,\n                    })\n                ),\n            {}\n        );\n    }\n);\nconfig.addProcessorToMap(OP_FILTER, 'OP_FILTER', false, (\n    left,\n    right,\n    prefix /*, context*/\n) => {\n    if (left == null) return null;\n\n    if (typeof left !== 'object') {\n        throw new InvalidArgument(MSG.VALUE_NOT_COLLECTION('OP_FILTER'));\n    }\n\n    return _filter(left, (value, key) =>\n        test(value, 'OP_MATCH', right, MSG.formatPrefix(key, prefix))\n    );\n});\nconfig.addProcessorToMap(OP_REMAP, 'OP_REMAP', false, (\n    left,\n    right /*, prefix, context*/\n) => {\n    if (left == null) return null;\n\n    if (typeof left !== 'object') {\n        throw new InvalidArgument(MSG.VALUE_NOT_COLLECTION('OP_REMAP'));\n    }\n\n    if (Array.isArray(right)) {\n        if (right.length !== 2) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_TUPLE('OP_REMAP'));\n        }\n\n        return remap(left, right[0], right[1]);\n    }\n\n    if (!isPlainObject(right)) {\n        throw new InvalidArgument(MSG.OPERAND_NOT_OBJECT('OP_REMAP'));\n    }\n\n    return remap(left, right);\n});\nconfig.addProcessorToMap(\n    OP_IF,\n    'OP_IF',\n    false,\n    (left, right, prefix, context) => {\n        if (!Array.isArray(right)) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_ARRAY('OP_IF'));\n        }\n\n        if (right.length < 2 || right.length > 3) {\n            throw new InvalidArgument(MSG.OPERAND_NOT_TUPLE_2_OR_3('OP_IF'));\n        }\n\n        const condition = evaluateExpr(\n            undefined,\n            right[0],\n            prefix,\n            context,\n            true\n        );\n\n        if (test(left, 'OP_MATCH', condition, prefix)) {\n            return evaluateExpr(left, right[1], prefix, context);\n        } else if (right.length > 2) {\n            const ret = evaluateExpr(left, right[2], prefix, context);\n            return ret;\n        }\n\n        return left;\n    }\n);\n//embeded validators in processing pipeline\nconfig.addProcessorToMap(OP_MATCH, 'OP_MATCH', false, (left, right, prefix) => {\n    return test(left, 'OP_MATCH', right, prefix);\n});\n\nconfig.addProcessorToMap(OP_TO_JSON, 'OP_TO_JSON', true, (left) =>\n    left == null ? left : JSON.stringify(left)\n);\nconfig.addProcessorToMap(OP_TO_OBJ, 'OP_TO_OBJ', true, (left) =>\n    left == null ? left : JSON.parse(left)\n);\n\nfunction getUnmatchedExplanation(\n    op,\n    name,\n    leftValue,\n    rightValue,\n    prefix,\n    context\n) {\n    if (context && context.$$ERROR) return context.$$ERROR;\n\n    const getter = MSG.validationErrors[op] || MSG.validationErrors.OP_MATCH;\n    return getter(name, leftValue, rightValue, prefix);\n}\n\nfunction test(value, tag, opValue, prefix, context) {\n    const handler = config.getValidator(tag);\n\n    if (!handler) {\n        throw new InvalidArgument(MSG.INVALID_VALIDATOR_HANDLER(tag));\n    }\n\n    return handler(value, opValue, prefix, context);\n}\n\nfunction evaluate(value, tag, opValue, prefix, context) {\n    const handler = config.getProcessor(tag);\n\n    if (!handler) {\n        throw new InvalidArgument(MSG.INVALID_PROCESSOR_HANDLER(tag));\n    }\n\n    return handler(value, opValue, prefix, context);\n}\n\nfunction evaluateUnary(value, tag, prefix, context) {\n    const handler = config.getProcessor(tag);\n\n    if (!handler) {\n        throw new InvalidArgument(MSG.INVALID_PROCESSOR_HANDLER(tag));\n    }\n\n    return handler(value, prefix, context);\n}\n\nfunction evaluateByOpMeta(currentValue, rightValue, opMeta, prefix, context) {\n    if (opMeta[1]) {\n        return rightValue\n            ? evaluateUnary(currentValue, opMeta[0], prefix)\n            : currentValue;\n    }\n\n    return evaluate(currentValue, opMeta[0], rightValue, prefix, context);\n}\n\nfunction validateCollection(\n    actual,\n    collectionOp,\n    op,\n    expectedFieldValue,\n    prefix\n) {\n    const context = {};\n\n    switch (collectionOp) {\n        case PFX_FOR_EACH: {\n            const unmatchedKey = _findIndex(\n                actual,\n                (item) => !test(item, op, expectedFieldValue, prefix, context)\n            );\n\n            if (unmatchedKey !== -1) {\n                return [\n                    false,\n                    getUnmatchedExplanation(\n                        op,\n                        unmatchedKey,\n                        actual[unmatchedKey],\n                        expectedFieldValue,\n                        prefix,\n                        context\n                    ),\n                ];\n            }\n            break;\n        }\n\n        case PFX_WITH_ANY: {\n            const matched = _find(actual, (item) =>\n                test(item, op, expectedFieldValue, prefix, context)\n            );\n\n            if (!matched) {\n                return [\n                    false,\n                    getUnmatchedExplanation(\n                        op,\n                        null,\n                        actual,\n                        expectedFieldValue,\n                        prefix,\n                        context\n                    ),\n                ];\n            }\n            break;\n        }\n\n        default:\n            throw new InvalidArgument(MSG.INVALID_COLLECTION_OP(collectionOp));\n    }\n\n    return undefined;\n}\n\nfunction evaluateCollection(\n    currentValue,\n    collectionOp,\n    opMeta,\n    expectedFieldValue,\n    prefix,\n    context\n) {\n    switch (collectionOp) {\n        case PFX_FOR_EACH:\n            return (Array.isArray(currentValue)\n                ? _map\n                : _mapValues)(currentValue, (item, i) =>\n                evaluateByOpMeta(\n                    item,\n                    expectedFieldValue,\n                    opMeta,\n                    MSG.formatPrefix(i, prefix),\n                    { ...context, $$PARENT: currentValue, $$CURRENT: item }\n                )\n            );\n\n        default:\n            throw new InvalidArgument(MSG.INVALID_COLLECTION_OP(collectionOp));\n    }\n}\n\n/**\n * Validate the given object with JSON Expression Syntax (JES)\n * @param {*} actual - The object to match\n * @param {*} expected - Expected state in JSON Expression Syntax\n * @param {*} prefix - Tracking path\n *\n * { key: { $match } }\n */\nfunction match(actual, expected, prefix) {\n    let passObjectCheck = false;\n\n    if (!isPlainObject(expected)) {\n        if (!test(actual, 'OP_EQUAL', expected, prefix)) {\n            return [\n                false,\n                MSG.validationErrors.OP_EQUAL(null, actual, expected, prefix),\n            ];\n        }\n\n        return [true];\n    }\n\n    for (let fieldName in expected) {\n        let expectedFieldValue = expected[fieldName];\n\n        const l = fieldName.length;\n\n        if (l > 1) {\n            if (l > 3 && fieldName[0] === '|' && fieldName[2] === '$') {\n                //validators\n                const collectionOp = fieldName.substr(0, 2);\n                fieldName = fieldName.substr(2);\n\n                const op = config.getValidatorTag(fieldName);\n                if (!op) {\n                    throw new InvalidArgument(\n                        MSG.INVALID_VALIDATION_OP(fieldName)\n                    );\n                }\n\n                const matchResult = validateCollection(\n                    actual,\n                    collectionOp,\n                    op,\n                    expectedFieldValue,\n                    prefix\n                );\n                if (matchResult) return matchResult;\n                continue;\n            }\n\n            if (fieldName[0] === '$') {\n                //validator\n                const op = config.getValidatorTag(fieldName);\n                if (!op) {\n                    throw new InvalidArgument(\n                        MSG.INVALID_VALIDATION_OP(fieldName)\n                    );\n                }\n\n                const context = {};\n\n                if (!test(actual, op, expectedFieldValue, prefix, context)) {\n                    return [\n                        false,\n                        getUnmatchedExplanation(\n                            op,\n                            null,\n                            actual,\n                            expectedFieldValue,\n                            prefix,\n                            context\n                        ),\n                    ];\n                }\n\n                continue;\n            }\n        }\n\n        if (!passObjectCheck) {\n            if (actual == null)\n                return [\n                    false,\n                    MSG.validationErrors.OP_EXISTS(null, null, true, prefix),\n                ];\n\n            const actualType = typeof actual;\n\n            if (actualType !== 'object')\n                return [\n                    false,\n                    MSG.validationErrors.OP_TYPE(\n                        null,\n                        actualType,\n                        'object',\n                        prefix\n                    ),\n                ];\n        }\n\n        passObjectCheck = true;\n\n        let actualFieldValue = _get(actual, fieldName);\n\n        if (\n            expectedFieldValue != null &&\n            typeof expectedFieldValue === 'object'\n        ) {\n            const [ok, reason] = match(\n                actualFieldValue,\n                expectedFieldValue,\n                MSG.formatPrefix(fieldName, prefix)\n            );\n            if (!ok) {\n                return [false, reason];\n            }\n        } else {\n            if (\n                !test(actualFieldValue, 'OP_EQUAL', expectedFieldValue, prefix)\n            ) {\n                return [\n                    false,\n                    MSG.validationErrors.OP_EQUAL(\n                        fieldName,\n                        actualFieldValue,\n                        expectedFieldValue,\n                        prefix\n                    ),\n                ];\n            }\n        }\n    }\n\n    return [true];\n}\n\n/**\n * If $ operator used, only one a time is allowed\n * e.g.\n * {\n *    $groupBy: 'key'\n * }\n *\n *\n * @param {*} currentValue\n * @param {*} expr\n * @param {*} prefix\n * @param {*} context\n * @param {boolean} setOp - Whether the expression is a setOp\n */\nfunction evaluateExpr(currentValue, expr, prefix, context, setOp) {\n    if (Array.isArray(expr)) {\n        if (setOp) {\n            return expr.map((item) =>\n                evaluateExpr(undefined, item, prefix, { ...context }, true)\n            );\n        }\n\n        return expr.reduce(\n            (result, exprItem) =>\n                evaluateExpr(result, exprItem, prefix, { ...context }),\n            currentValue\n        );\n    }\n\n    const typeExpr = typeof expr;\n\n    if (typeExpr === 'boolean') {\n        if (setOp) return expr;\n        return expr ? currentValue : undefined;\n    }\n\n    if (typeExpr === 'number' || typeExpr === 'bigint') {\n        if (setOp) return expr;\n\n        throw new InvalidArgument(MSG.SYNTAX_NUMBER_AS_EXPR);\n    }\n\n    if (typeExpr === 'string') {\n        if (expr.startsWith('$$')) {\n            //get from context\n            const pos = expr.indexOf('.');\n            if (pos === -1) {\n                return context[expr];\n            }\n\n            return _get(context[expr.substr(0, pos)], expr.substr(pos + 1));\n        }\n\n        if (setOp) {\n            return expr;\n        }\n\n        const opMeta = config.getProcessorTagAndType(expr);\n        if (!opMeta) {\n            throw new InvalidArgument(MSG.INVALID_PROCESSING_OP(expr));\n        }\n\n        if (!opMeta[1]) {\n            throw new InvalidArgument(MSG.REQUIRE_RIGHT_OPERAND(expr));\n        }\n\n        return evaluateUnary(currentValue, opMeta[0], prefix);\n    }\n\n    if (typeExpr !== 'object') {\n        throw new InvalidArgument(MSG.SYNTAX_INVALID_EXPR);\n    }\n\n    if (setOp) {\n        return _mapValues(expr, (item) =>\n            evaluateExpr(undefined, item, prefix, context, true)\n        );\n    }\n\n    if (context == null) {\n        context = {\n            $$ROOT: currentValue,\n            $$PARENT: null,\n            $$CURRENT: currentValue,\n        };\n    }\n\n    let result,\n        hasOperator = false;\n\n    for (let fieldName in expr) {\n        let expectedFieldValue = expr[fieldName];\n\n        const l = fieldName.length;\n\n        if (l > 1) {\n            if (fieldName[0] === '$') {\n                if (result) {\n                    throw new InvalidArgument(MSG.SYNTAX_OP_NOT_ALONE);\n                }\n\n                const opMeta = config.getProcessorTagAndType(fieldName);\n                if (!opMeta) {\n                    throw new InvalidArgument(\n                        MSG.INVALID_PROCESSING_OP(fieldName)\n                    );\n                }\n\n                if (hasOperator) {\n                    throw new InvalidArgument(MSG.SYNTAX_OP_NOT_ALONE);\n                }\n\n                result = evaluateByOpMeta(\n                    currentValue,\n                    expectedFieldValue,\n                    opMeta,\n                    prefix,\n                    context\n                );\n                hasOperator = true;\n                continue;\n            }\n\n            if (l > 3 && fieldName[0] === '|' && fieldName[2] === '$') {\n                if (result) {\n                    throw new InvalidArgument(MSG.SYNTAX_OP_NOT_ALONE);\n                }\n\n                const collectionOp = fieldName.substr(0, 2);\n                fieldName = fieldName.substr(2);\n\n                const opMeta = config.getProcessorTagAndType(fieldName);\n                if (!opMeta) {\n                    throw new InvalidArgument(\n                        MSG.INVALID_PROCESSING_OP(fieldName)\n                    );\n                }\n\n                if (hasOperator) {\n                    throw new InvalidArgument(MSG.SYNTAX_OP_NOT_ALONE);\n                }\n\n                result = evaluateCollection(\n                    currentValue,\n                    collectionOp,\n                    opMeta,\n                    expectedFieldValue,\n                    prefix,\n                    context\n                );\n                hasOperator = true;\n                continue;\n            }\n        }\n\n        if (hasOperator) {\n            throw new InvalidArgument(MSG.SYNTAX_OP_NOT_ALONE);\n        }\n\n        let compleyKey = fieldName.indexOf('.') !== -1;\n\n        //pick a field and then apply manipulation\n        let actualFieldValue =\n            currentValue != null\n                ? compleyKey\n                    ? _get(currentValue, fieldName)\n                    : currentValue[fieldName]\n                : undefined;\n\n        const childFieldValue = evaluateExpr(\n            actualFieldValue,\n            expectedFieldValue,\n            MSG.formatPrefix(fieldName, prefix),\n            context\n        );\n\n        if (typeof childFieldValue !== 'undefined') {\n            result == null && (result = {});\n            if (compleyKey) {\n                _set(result, fieldName, childFieldValue);\n            } else {\n                result[fieldName] = childFieldValue;\n            }\n        }\n    }\n\n    return result;\n}\n\n/**\n * JSON Expression Syntax Object\n * @class\n */\nclass JES {\n    static config = config;\n    static match = match;\n    static evaluate = evaluateExpr;\n\n    /**\n     * @param {object} value\n     */\n    constructor(value) {\n        this.value = value;\n    }\n\n    /**\n     * Match the value with expected conditions in JSON expression\n     * @param {object} expected - JSON match expression\n     * @throws ValidationError\n     * @returns {JES}\n     */\n    match(expected) {\n        const result = match(this.value, expected);\n        if (result[0]) return this;\n\n        throw new ValidationError(result[1], {\n            actual: this.value,\n            expected,\n        });\n    }\n\n    /**\n     * Evaluate a JSON expression against the value\n     * @param {object} - JSON operation expression\n     */\n    evaluate(expr) {\n        return evaluateExpr(this.value, expr);\n    }\n\n    /**\n     * Evaluate a JSON expression against the value and update the value\n     * @param {object} - JSON operation expression\n     * @returns {JES}\n     */\n    update(expr) {\n        this.value = evaluateExpr(this.value, expr);\n        return this;\n    }\n}\n\nexport default JES;\n"]}