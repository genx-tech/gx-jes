{"version":3,"file":"array.js","names":["name","alias","validate","value","itemSchema","options","useFieldPath","abortEarly","throwError","context","Array","isArray","invalidType","errors","_find","fieldValue","i","path","messages","makePath","reason","$$PARENT","$$CURRENT","ValidationError","push","length"],"sources":["../../src/types/array.js"],"sourcesContent":["import _find from 'lodash/find';\n\nimport ValidationError from '../ValidationError';\nimport { messages } from '../config';\nimport validate, { invalidType } from '../validate';\n\nexport default {\n    name: 'array',\n\n    alias: ['list'],\n\n    /**\n     *\n     * @param {*} value\n     * @param {*} itemSchema\n     * @param {*} options\n     * @param {*} context\n     * @returns {true|ValidationError}\n     */\n    validate: (\n        value,\n        itemSchema,\n        options = { useFieldPath: true, abortEarly: true, throwError: true },\n        context = {}\n    ) => {\n        const { abortEarly, throwError } = options;\n\n        if (value != null && !Array.isArray(value)) {\n            return invalidType(value, 'array', options, context);\n        }\n\n        if (typeof itemSchema === 'function') {\n            // use deferred activation of schema to avoid circullar reference\n            itemSchema = itemSchema();\n        }\n\n        if (value) {\n            const errors = [];\n\n            _find(value, (fieldValue, i) => {\n                const path = messages.makePath(i, context.path);\n                const reason = validate(fieldValue, itemSchema, options, {\n                    name: null,\n                    path,\n                    $$PARENT: value,\n                    $$CURRENT: fieldValue,\n                });\n\n                if (reason !== true) {\n                    if (abortEarly) {\n                        if (throwError) {\n                            throw new ValidationError(reason, fieldValue, path);\n                        }\n\n                        return reason;\n                    }\n\n                    errors.push(...reason);\n                }\n            });\n\n            if (errors.length > 0) {\n                if (throwError) {\n                    throw new ValidationError(errors, value, context.path);\n                }\n\n                return errors;\n            }\n        }\n\n        return true;\n    },\n};\n"],"mappings":";;;;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;eAEe;EACXA,IAAI,EAAE,OADK;EAGXC,KAAK,EAAE,CAAC,MAAD,CAHI;;EAKX;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,QAAQ,EAAE,kBACNC,KADM,EAENC,UAFM,EAKL;IAAA,IAFDC,OAEC,uEAFS;MAAEC,YAAY,EAAE,IAAhB;MAAsBC,UAAU,EAAE,IAAlC;MAAwCC,UAAU,EAAE;IAApD,CAET;IAAA,IADDC,OACC,uEADS,EACT;IACD,IAAQF,UAAR,GAAmCF,OAAnC,CAAQE,UAAR;IAAA,IAAoBC,UAApB,GAAmCH,OAAnC,CAAoBG,UAApB;;IAEA,IAAIL,KAAK,IAAI,IAAT,IAAiB,CAACO,KAAK,CAACC,OAAN,CAAcR,KAAd,CAAtB,EAA4C;MACxC,OAAO,IAAAS,sBAAA,EAAYT,KAAZ,EAAmB,OAAnB,EAA4BE,OAA5B,EAAqCI,OAArC,CAAP;IACH;;IAED,IAAI,OAAOL,UAAP,KAAsB,UAA1B,EAAsC;MAClC;MACAA,UAAU,GAAGA,UAAU,EAAvB;IACH;;IAED,IAAID,KAAJ,EAAW;MACP,IAAMU,MAAM,GAAG,EAAf;MAEA,IAAAC,iBAAA,EAAMX,KAAN,EAAa,UAACY,UAAD,EAAaC,CAAb,EAAmB;QAC5B,IAAMC,IAAI,GAAGC,gBAAA,CAASC,QAAT,CAAkBH,CAAlB,EAAqBP,OAAO,CAACQ,IAA7B,CAAb;;QACA,IAAMG,MAAM,GAAG,IAAAlB,qBAAA,EAASa,UAAT,EAAqBX,UAArB,EAAiCC,OAAjC,EAA0C;UACrDL,IAAI,EAAE,IAD+C;UAErDiB,IAAI,EAAJA,IAFqD;UAGrDI,QAAQ,EAAElB,KAH2C;UAIrDmB,SAAS,EAAEP;QAJ0C,CAA1C,CAAf;;QAOA,IAAIK,MAAM,KAAK,IAAf,EAAqB;UACjB,IAAIb,UAAJ,EAAgB;YACZ,IAAIC,UAAJ,EAAgB;cACZ,MAAM,IAAIe,2BAAJ,CAAoBH,MAApB,EAA4BL,UAA5B,EAAwCE,IAAxC,CAAN;YACH;;YAED,OAAOG,MAAP;UACH;;UAEDP,MAAM,CAACW,IAAP,OAAAX,MAAM,qBAASO,MAAT,EAAN;QACH;MACJ,CApBD;;MAsBA,IAAIP,MAAM,CAACY,MAAP,GAAgB,CAApB,EAAuB;QACnB,IAAIjB,UAAJ,EAAgB;UACZ,MAAM,IAAIe,2BAAJ,CAAoBV,MAApB,EAA4BV,KAA5B,EAAmCM,OAAO,CAACQ,IAA3C,CAAN;QACH;;QAED,OAAOJ,MAAP;MACH;IACJ;;IAED,OAAO,IAAP;EACH;AAjEU,C"}